<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LevPay Admin</title>
  <link rel="stylesheet" href="./admin.css" />
  <script>
    // Override kalau lu mau (optional):
    // window.LevPayAdminAPIBase = "https://levpay-api.vercel.app/api/orkut";
  </script>
</head>

<body>
  <!-- Blur gate -->
  <div id="gate" class="gate is-on" aria-hidden="false">
    <div class="gate__backdrop"></div>
    <div class="gate__panel">
      <div class="brand">
        <div class="brand__logo">LP</div>
        <div>
          <div class="brand__title">LevPay Admin</div>
          <div class="brand__sub">Masukkan Admin Key untuk mengakses pengaturan.</div>
        </div>
      </div>

      <div class="gate__form">
        <label class="label">Admin Key</label>
        <input id="adminKeyInput" class="input" placeholder="contoh: LEVIN6824" type="password" autocomplete="off" />

        <div class="row row--gap">
          <button id="btnLogin" class="btn btn--primary">Masuk</button>
          <button id="btnLogout" class="btn btn--ghost" disabled>Keluar</button>
        </div>

        <div class="divider"></div>

        <label class="label">API Base (optional)</label>
        <input id="apiBaseInput" class="input mono" placeholder="https://levpay-api.vercel.app/api/orkut" />
        <div class="row row--gap" style="margin-top:10px;">
          <button id="btnSaveApiBase" class="btn btn--ghost">Simpan API Base</button>
        </div>

        <div class="hint">
          Default API:
          <code class="mono">https://levpay-api.vercel.app/api/orkut</code>
        </div>

        <div id="loginMsg" class="msg" style="display:none;"></div>
      </div>
    </div>
  </div>

  <!-- App -->
  <div id="app" class="app is-locked">
    <header class="topbar">
      <div class="topbar__left">
        <div class="brandMini">
          <div class="brandMini__logo">LP</div>
          <div>
            <div class="brandMini__title">LevPay Admin</div>
            <div class="brandMini__sub">
              API: <span class="mono" id="apiBaseText">—</span>
            </div>
          </div>
        </div>
      </div>

      <div class="topbar__right">
        <button id="btnRefreshAll" class="btn btn--ghost">Refresh</button>
        <button id="btnOpenGate" class="btn btn--ghost">Admin Key</button>
      </div>
    </header>

    <main class="layout">
      <aside class="side">
        <div class="side__box">
          <button class="navItem is-active" data-tab="vouchers">
            <span>Voucher</span><span class="pill" id="pillVoucherCount">0</span>
          </button>
          <button class="navItem" data-tab="monthly">
            <span>Promo Bulanan</span><span class="pill" id="pillMonthly">—</span>
          </button>
          <button class="navItem" data-tab="tools">
            <span>Tools</span><span class="pill pill--tag">curl</span>
          </button>
        </div>

        <div class="side__box side__box--mini">
          <div class="kv">
            <div class="kv__k">Status</div>
            <div class="kv__v" id="sysStatus">LOCKED</div>
          </div>
          <div class="kv">
            <div class="kv__k">Last Sync</div>
            <div class="kv__v mono" id="lastSync">—</div>
          </div>
          <div class="divider"></div>

          <div class="switchRow">
            <div>
              <div class="switchTitle">Unlimited device ini</div>
              <div class="switchSub">
                Device: <span class="mono" id="u_device">—</span> • Total whitelist: <span class="mono" id="u_count">0</span>
              </div>
            </div>

            <label class="switch" title="Toggle unlimited untuk device ini">
              <input id="u_enabled" type="checkbox" />
              <span class="switchTrack">
                <span class="switchKnob"></span>
              </span>
            </label>
          </div>

          <div id="msgUnlimited" class="msg" style="display:none;"></div>

          <div class="divider"></div>
          <div class="hint">
            Kalau curl discount.apply bisa tapi frontend nggak kepotong, biasanya frontend nembak API yang beda.
            Final ini dipaksa konsisten: admin + frontend sama-sama pakai <span class="mono">/api/orkut</span>.
          </div>
        </div>
      </aside>

      <section class="main">
        <!-- VOUCHERS TAB -->
        <div class="tab is-on" id="tab-vouchers">
          <div class="grid2">
            <div class="card">
              <div class="card__head">
                <div>
                  <div class="card__title">Voucher Manager</div>
                  <div class="card__sub">Buat / update voucher, disable, atau hapus.</div>
                </div>
                <div class="row row--gap">
                  <label class="check">
                    <input id="onlyActiveToggle" type="checkbox" checked />
                    <span>Hanya yang aktif</span>
                  </label>
                  <button id="btnLoadVouchers" class="btn btn--ghost">Load</button>
                </div>
              </div>

              <div class="card__body card__body--pad0">
                <div class="tableWrap">
                  <table class="table">
                    <thead>
                      <tr>
                        <th>Kode</th>
                        <th>Nama</th>
                        <th>Aktif</th>
                        <th>%</th>
                        <th>Max Rp</th>
                        <th>Uses</th>
                        <th>Expire</th>
                        <th class="tRight">Aksi</th>
                      </tr>
                    </thead>
                    <tbody id="voucherTbody">
                      <tr><td colspan="9" class="mutedCell">Belum ada data.</td></tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <div class="card">
              <div class="card__head">
                <div>
                  <div class="card__title">Edit Voucher</div>
                  <div class="card__sub">Toggle beneran nyimpan ke backend.</div>
                </div>
              </div>

              <div class="card__body">
                <div class="formGrid">
                  <div class="field">
                    <label class="label">Code</label>
                    <input id="v_code" class="input mono" placeholder="contoh: 2026 / VIPL" />
                  </div>
                  <div class="field">
                    <label class="label">Name</label>
                    <input id="v_name" class="input" placeholder="contoh: NEWYEAR 99%" />
                  </div>

                  <div class="field">
                    <label class="label">Percent (0-100)</label>
                    <input id="v_percent" class="input" inputmode="numeric" placeholder="contoh: 60" />
                  </div>
                  <div class="field">
                    <label class="label">Max Rp (0 = unlimited)</label>
                    <input id="v_maxRp" class="input" inputmode="numeric" placeholder="contoh: 5000" value="0" />
                  </div>

                  <div class="field">
                    <label class="label">Max Uses (kosong = unlimited)</label>
                    <input id="v_maxUses" class="input" inputmode="numeric" placeholder="contoh: 5" />
                    <div class="hint">Global limit total pemakaian voucher (paid). Device unlimited ga ngurangin kuota.</div>
                  </div>

                  <div class="field">
                    <label class="label">Expires At</label>
                    <input id="v_expiresAt" class="input" type="datetime-local" />
                    <div class="hint">Kosongkan kalau tidak ada expire.</div>
                  </div>

                  <div class="field field--full">
                    <label class="check">
                      <input id="v_enabled" type="checkbox" checked />
                      <span>Enabled</span>
                    </label>
                  </div>
                </div>

                <div class="row row--gap">
                  <button id="btnUpsertVoucher" class="btn btn--primary">Simpan</button>
                  <button id="btnDisableVoucher" class="btn btn--ghost">Disable</button>
                  <button id="btnDeleteVoucher" class="btn btn--danger">Hapus</button>
                </div>

                <div class="split">
                  <div>
                    <div class="miniTitle">curl (auto)</div>
                    <pre class="codebox" id="curlVoucher">—</pre>
                  </div>
                  <div>
                    <div class="miniTitle">Response</div>
                    <pre class="codebox" id="jsonVoucher">—</pre>
                  </div>
                </div>

                <div id="msgVoucher" class="msg" style="display:none;"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- MONTHLY TAB -->
        <div class="tab" id="tab-monthly">
          <div class="grid2">
            <div class="card">
              <div class="card__head">
                <div>
                  <div class="card__title">Promo Bulanan</div>
                  <div class="card__sub">1× per device per bulan (kecuali Unlimited device).</div>
                </div>
                <div class="row row--gap">
                  <button id="btnLoadMonthly" class="btn btn--ghost">Load</button>
                  <button id="btnSaveMonthly" class="btn btn--primary">Save</button>
                </div>
              </div>

              <div class="card__body">
                <div class="formGrid">
                  <div class="field field--full">
                    <label class="check">
                      <input id="m_enabled" type="checkbox" />
                      <span>Enabled</span>
                    </label>
                  </div>

                  <div class="field">
                    <label class="label">Kode Promo Bulanan</label>
                    <input id="m_code" class="input mono" placeholder="contoh: KLZ" />
                    <div class="hint">User harus masukin kode ini agar promo bulanan kepake.</div>
                  </div>

                  <div class="field">
                    <label class="label">Name</label>
                    <input id="m_name" class="input" placeholder="contoh: PROMO BULANAN" />
                  </div>

                  <div class="field">
                    <label class="label">Percent (0-100)</label>
                    <input id="m_percent" class="input" inputmode="numeric" placeholder="contoh: 5" />
                  </div>

                  <div class="field">
                    <label class="label">Max Rp</label>
                    <input id="m_maxRp" class="input" inputmode="numeric" placeholder="contoh: 2000" />
                  </div>

                  <div class="field field--full">
                    <label class="label">Max Uses / bulan (kosong = unlimited)</label>
                    <input id="m_maxUses" class="input" inputmode="numeric" placeholder="contoh: 10" />
                    <div class="hint">Global limit per bulan. Unlimited device bisa bypass.</div>
                  </div>
                </div>

                <div class="split">
                  <div>
                    <div class="miniTitle">curl (auto)</div>
                    <pre class="codebox" id="curlMonthly">—</pre>
                  </div>
                  <div>
                    <div class="miniTitle">Response</div>
                    <pre class="codebox" id="jsonMonthly">—</pre>
                  </div>
                </div>

                <div id="msgMonthly" class="msg" style="display:none;"></div>
              </div>
            </div>

            <div class="card">
              <div class="card__head">
                <div>
                  <div class="card__title">Catatan</div>
                  <div class="card__sub">Unlimited toggle ada di sidebar. Ga ada sha/pepper di UI.</div>
                </div>
              </div>
              <div class="card__body">
                <div class="hint">
                  Kalo promo/voucher masih ga kepotong di frontend, pastiin frontend nembak domain API yang sama.
                  Default LP#1.0.0: <span class="mono">https://levpay-api.vercel.app/api/orkut</span>.
                  Jangan campur sama endpoint lain.
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- TOOLS TAB -->
        <div class="tab" id="tab-tools">
          <div class="card">
            <div class="card__head">
              <div>
                <div class="card__title">Tools</div>
                <div class="card__sub">Test discount.apply (cek diskon engine).</div>
              </div>
              <div class="row row--gap">
                <button id="btnRunApply" class="btn btn--primary">Run</button>
              </div>
            </div>

            <div class="card__body">
              <div class="formGrid">
                <div class="field">
                  <label class="label">Amount</label>
                  <input id="t_amount" class="input mono" inputmode="numeric" value="3000" />
                </div>
                <div class="field">
                  <label class="label">Device ID</label>
                  <input id="t_deviceId" class="input mono" />
                </div>
                <div class="field">
                  <label class="label">Kode Diskon</label>
                  <input id="t_voucher" class="input mono" placeholder="2026 / KLZ / VIPL" />
                </div>
                <div class="field">
                  <label class="label">reserveTtlMs</label>
                  <input id="t_ttl" class="input mono" inputmode="numeric" value="360000" />
                </div>
              </div>

              <div class="split">
                <div>
                  <div class="miniTitle">curl (auto)</div>
                  <pre class="codebox" id="curlApply">—</pre>
                </div>
                <div>
                  <div class="miniTitle">Response</div>
                  <pre class="codebox" id="jsonApply">—</pre>
                </div>
              </div>

              <div class="hint">
                Tools ini hanya ngecek engine. Diskon di QR flow yang bener harusnya lewat <span class="mono">createqr</span>.
              </div>
            </div>
          </div>
        </div>

      </section>
    </main>

    <footer class="footer">
      <div class="footer__inner">
        <span>LevPay Admin</span>
        <span class="sep">•</span>
        <span class="mono">v4</span>
      </div>
    </footer>
  </div>

  <script src="./admin.js"></script>
</body>
</html>