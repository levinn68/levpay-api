<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LevPay Admin</title>

  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/flatpickr.min.css">

  <link rel="stylesheet" href="./assets/admin.css" />
</head>

<body class="locked">
  <!-- LOGIN OVERLAY -->
  <div class="overlay" id="overlay">
    <div class="modal">
      <div class="modal-head">
        <div class="mh-left">
          <div class="mh-badge"><i class="bi bi-shield-lock"></i></div>
          <div>
            <h3>Masuk Admin</h3>
            <p>Masukin <b>Admin Key</b>. Blur bakal hilang kalau key valid.</p>
          </div>
        </div>
        <button class="btn btn-ghost" id="btnReset"><i class="bi bi-arrow-counterclockwise"></i></button>
      </div>

      <div class="modal-body">
        <div class="grid2">
          <div>
            <label>API Host</label>
            <input class="input" id="inHost" placeholder="kosong = domain ini" />
            <div class="help">Contoh: <span class="mono">https://levpay-api.vercel.app</span></div>
          </div>
          <div>
            <label>Admin Key</label>
            <input class="input" id="inAdmin" type="password" placeholder="masukkan admin key..." />
            <div class="help">Disimpan lokal. Logout = hapus.</div>
          </div>
        </div>

        <div class="row">
          <button class="btn" id="btnPingLock"><i class="bi bi-wifi"></i>Ping</button>
          <button class="btn btn-primary" id="btnLogin"><i class="bi bi-door-open"></i>Masuk</button>
          <div class="spacer"></div>
          <span class="pill warn" id="pillApi"><span class="dot"></span><span id="pillApiText">API: belum dicek</span></span>
          <span class="pill warn" id="pillKey"><span class="dot"></span><span id="pillKeyText">Key: belum</span></span>
        </div>

        <div class="help">
          Admin page ini nembak ke endpoint: <span class="mono">/api/levpay?action=...</span>
        </div>
      </div>
    </div>
  </div>

  <!-- APP -->
  <div class="app" id="app">
    <div class="container">

      <!-- TOPBAR -->
      <header class="topbar">
        <div class="brand">
          <div class="logo"></div>
          <div class="brand-text">
            <div class="brand-title">LevPay Admin</div>
            <div class="brand-sub">Voucher • Monthly • Active • Tester</div>
          </div>
        </div>

        <div class="spacer"></div>

        <div class="top-actions">
          <span class="pill ok" id="pillActive"><span class="dot"></span><span id="pillActiveText">Active: —</span></span>
          <button class="btn" id="btnRefresh"><i class="bi bi-arrow-clockwise"></i><span>Refresh</span></button>
          <button class="btn btn-danger" id="btnLogout"><i class="bi bi-box-arrow-right"></i><span>Logout</span></button>
        </div>
      </header>

      <!-- LAYOUT -->
      <main class="shell">
        <!-- SIDEBAR -->
        <aside class="card sidebar">
          <div class="card-head">
            <div class="card-title"><i class="bi bi-grid-1x2"></i>Menu</div>
            <div class="host-mini mono" id="hostMini">—</div>
          </div>

          <div class="card-body">
            <nav class="nav">
              <button class="navbtn active" data-tab="active">
                <span class="left"><i class="bi bi-lightning-charge"></i>Active Discounts</span>
                <i class="bi bi-chevron-right chev"></i>
              </button>
              <button class="navbtn" data-tab="voucher">
                <span class="left"><i class="bi bi-ticket-perforated"></i>Custom Voucher</span>
                <i class="bi bi-chevron-right chev"></i>
              </button>
              <button class="navbtn" data-tab="monthly">
                <span class="left"><i class="bi bi-calendar2-week"></i>Monthly Promo</span>
                <i class="bi bi-chevron-right chev"></i>
              </button>
              <button class="navbtn" data-tab="tester">
                <span class="left"><i class="bi bi-play-circle"></i>Tester</span>
                <i class="bi bi-chevron-right chev"></i>
              </button>
              <button class="navbtn" data-tab="curl">
                <span class="left"><i class="bi bi-terminal"></i>cURL + JSON</span>
                <i class="bi bi-chevron-right chev"></i>
              </button>
            </nav>

            <div class="hr"></div>

            <div class="row">
              <button class="btn btn-ghost" id="btnCopyCurl"><i class="bi bi-clipboard"></i><span>Copy cURL</span></button>
              <button class="btn btn-ghost" id="btnCopyJson"><i class="bi bi-clipboard"></i><span>Copy JSON</span></button>
            </div>

            <div class="help">
              cURL pakai placeholder: <span class="mono">$HOST</span> & <span class="mono">$ADMIN</span>.
            </div>
          </div>
        </aside>

        <!-- CONTENT -->
        <section class="content vstack">
          <!-- TAB: ACTIVE -->
          <section class="tab active" id="tab-active">
            <div class="card">
              <div class="card-head">
                <div class="card-title"><i class="bi bi-lightning-charge"></i>Active Discounts</div>
                <div class="row">
                  <span class="pill ok" id="pillVoucher"><span class="dot"></span><span id="pillVoucherText">Voucher: —</span></span>
                  <span class="pill ok" id="pillMonthly"><span class="dot"></span><span id="pillMonthlyText">Monthly: —</span></span>
                </div>
              </div>

              <div class="card-body vstack">
                <div class="grid2">
                  <div>
                    <label>Search (nama / note)</label>
                    <input class="input" id="activeSearch" placeholder="Cari diskon..." />
                  </div>
                  <div>
                    <label>Show code</label>
                    <select class="select" id="showCode">
                      <option value="masked" selected>Masked</option>
                      <option value="show">Show</option>
                    </select>
                    <div class="help">Default disembunyiin (lebih aman production).</div>
                  </div>
                </div>

                <!-- scroll cuma di sini -->
                <div class="list-shell">
                  <div class="list-scroll">
                    <!-- Desktop table -->
                    <div class="desk-only">
                      <table class="tbl">
                        <thead>
                          <tr>
                            <th style="width:86px">Jenis</th>
                            <th style="width:86px">Status</th>
                            <th>Nama</th>
                            <th class="right" style="width:90px">Diskon</th>
                            <th class="right" style="width:110px">MaxRp</th>
                            <th class="right" style="width:110px">MaxUses</th>
                            <th style="width:170px">Expired</th>
                          </tr>
                        </thead>
                        <tbody id="activeTbody">
                          <tr><td colspan="7" class="muted">Loading…</td></tr>
                        </tbody>
                      </table>
                    </div>

                    <!-- Mobile cards -->
                    <div class="mob-only" id="activeCards">
                      <div class="mrow muted">Loading…</div>
                    </div>
                  </div>
                </div>

                <div class="help">Klik item untuk auto-isi form (voucher / monthly) + auto-generate cURL.</div>
              </div>
            </div>
          </section>

          <!-- TAB: VOUCHER -->
          <section class="tab" id="tab-voucher">
            <div class="card">
              <div class="card-head">
                <div class="card-title"><i class="bi bi-ticket-perforated"></i>Custom Voucher</div>
                <div class="row">
                  <button class="btn" id="btnNewVoucher"><i class="bi bi-plus-lg"></i><span>New</span></button>
                  <button class="btn" id="btnLoadVouchers"><i class="bi bi-download"></i><span>Load</span></button>
                  <button class="btn btn-primary" id="btnUpsert"><i class="bi bi-save2"></i><span>Save</span></button>
                  <button class="btn btn-danger" id="btnDisable"><i class="bi bi-toggle-off"></i><span>Disable</span></button>
                </div>
              </div>

              <div class="card-body vstack">
                <div class="grid2">
                  <div>
                    <label>Voucher Code</label>
                    <input class="input mono" id="vCode" placeholder="contoh: VIPL" autocomplete="off" />
                    <div class="help">Uppercase, tanpa spasi.</div>
                  </div>
                  <div>
                    <label>Enabled</label>
                    <select class="select" id="vEnabled">
                      <option value="true">true</option>
                      <option value="false">false</option>
                    </select>
                  </div>
                </div>

<div class="grid3">
  <div>
    <label>Diskon (%)</label>
    <input class="input" id="mPercent" type="number" min="0" max="100" step="1" />
  </div>
  <div>
    <label>Max Rp</label>
    <input class="input" id="mMaxRp" type="number" min="0" step="1" />
  </div>
  <div>
    <label>Max Uses (kosong = unlimited)</label>
    <input class="input" id="mMaxUses" type="number" min="1" step="1" placeholder="" />
  </div>
</div>

                <div class="grid3">
                  <div>
                    <label>Max Rp (0 = unlimited)</label>
                    <input class="input" id="vMaxRp" type="number" min="0" step="1" value="0" />
                  </div>
                  <div>
                    <label>Max Uses (kosong = unlimited)</label>
                    <input class="input" id="vMaxUses" type="number" min="1" step="1" placeholder="" />
                  </div>
                  <div>
                    <label>Expired (optional)</label>
                    <input class="input" id="vExpiresAt" placeholder="Pilih tanggal & jam…" />
                  </div>
                </div>

                <div>
                  <label>Note</label>
                  <textarea class="textarea" id="vNote" placeholder="Catatan internal…"></textarea>
                </div>

                <div class="hint">
                  <i class="bi bi-info-circle"></i>
                  Kalau diskon “ketahan kecil”, cek <b>maxRp</b>. Set <b>0</b> biar unlimited.
                </div>
              </div>
            </div>
          </section>

          <!-- TAB: MONTHLY -->
          <section class="tab" id="tab-monthly">
            <div class="card">
              <div class="card-head">
                <div class="card-title"><i class="bi bi-calendar2-week"></i>Monthly Promo</div>
                <div class="row">
                  <button class="btn" id="btnGetMonthly"><i class="bi bi-download"></i><span>Get</span></button>
                  <button class="btn btn-primary" id="btnSetMonthly"><i class="bi bi-save2"></i><span>Save</span></button>
                </div>
              </div>
              <div class="card-body vstack">
                <div class="grid2">
                  <div>
                    <label>Enabled</label>
                    <select class="select" id="mEnabled">
                      <option value="true">true</option>
                      <option value="false">false</option>
                    </select>
                  </div>
                  <div>
                    <label>Nama Promo</label>
                    <input class="input" id="mName" placeholder="PROMO BULANAN" />
                  </div>
                </div>

                <div class="grid2">
                  <div>
                    <label>Diskon (%)</label>
                    <input class="input" id="mPercent" type="number" min="0" max="100" step="1" />
                  </div>
                  <div>
                    <label>Max Rp</label>
                    <input class="input" id="mMaxRp" type="number" min="0" step="1" />
                  </div>
                </div>

                <div class="info">
                  <div class="info-ic"><i class="bi bi-shield-check"></i></div>
                  <div class="info-txt">
                    Monthly itu <b>1× per device per bulan</b> (tracking pakai <span class="mono">deviceKey</span>).
                    <br/>
                    <b>SHA256</b> = hash algorithm. <b>Pepper</b> = secret server dicampur sebelum hash biar gak bisa ditebak.
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- TAB: TESTER -->
          <section class="tab" id="tab-tester">
            <div class="card">
              <div class="card-head">
                <div class="card-title"><i class="bi bi-play-circle"></i>Tester</div>
                <div class="row">
                  <button class="btn" id="btnGenDevice"><i class="bi bi-shuffle"></i><span>Generate Device</span></button>
                  <button class="btn btn-success" id="btnApply"><i class="bi bi-percent"></i><span>discount.apply</span></button>
                  <button class="btn btn-primary" id="btnCreateQR"><i class="bi bi-qr-code"></i><span>createqr</span></button>
                </div>
              </div>
              <div class="card-body vstack">
                <div class="grid3">
                  <div>
                    <label>Amount</label>
                    <input class="input" id="tAmount" type="number" min="1" step="1" value="10000" />
                  </div>
                  <div>
                    <label>Device ID</label>
                    <input class="input mono" id="tDeviceId" placeholder="dev_web_xxx" />
                  </div>
                  <div>
                    <label>Voucher Code</label>
                    <input class="input mono" id="tVoucher" placeholder="contoh: VIPL" />
                  </div>
                </div>
                <div class="help">discount.apply buat test diskon. createqr kalau backend support.</div>
              </div>
            </div>
          </section>

          <!-- TAB: CURL -->
          <section class="tab" id="tab-curl">
            <div class="card">
              <div class="card-head">
                <div class="card-title"><i class="bi bi-terminal"></i>cURL + JSON</div>
                <div class="row">
                  <button class="btn btn-ghost" id="btnCopyResp"><i class="bi bi-clipboard"></i><span>Copy Response</span></button>
                  <button class="btn" id="btnPing"><i class="bi bi-wifi"></i><span>Ping</span></button>
                </div>
              </div>
              <div class="card-body vstack">
                <div class="grid2">
                  <div>
                    <label>cURL (auto)</label>
                    <div class="codebox" id="curlBox">—</div>
                  </div>
                  <div>
                    <label>JSON Body (auto)</label>
                    <div class="codebox" id="bodyBox">{}</div>
                  </div>
                </div>

                <div>
                  <label>Response JSON</label>
                  <div class="codebox" id="respBox">{}</div>
                </div>
              </div>
            </div>
          </section>

        </section>
      </main>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/flatpickr@4.6.13"></script>
  <script src="./assets/admin.js"></script>
</body>
</html>