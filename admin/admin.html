<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LevPay Admin</title>
  <link rel="stylesheet" href="./admin.css" />
</head>

<body>
  <!-- GATE / LOGIN (WAJIB MUNCUL DULUAN) -->
  <div id="gate" class="gate is-on" aria-hidden="false">
    <div class="gate__backdrop"></div>
    <div class="gate__panel">
      <div class="gate__brand">
        <div class="logo">LP</div>
        <div class="txt">
          <div class="t1">LevPay Admin</div>
          <div class="t2">Masukkan Admin Key untuk akses pengaturan.</div>
        </div>
      </div>

      <div class="gate__form">
        <label class="label">Admin Key</label>
        <input id="adminKeyInput" class="input mono" placeholder="ADMIN_KEY (env)" type="password" autocomplete="off" />

        <div class="row">
          <button id="btnLogin" class="btn primary">Masuk</button>
          <button id="btnLogout" class="btn ghost">Logout</button>
        </div>

        <div class="hint">
          Endpoint API: <span class="mono">/api/levpay</span>
        </div>

        <div id="gateMsg" class="msg" style="display:none;"></div>
      </div>
    </div>
  </div>

  <!-- APP -->
  <header class="topbar">
    <div class="brand">
      <div class="logo sm">LP</div>
      <div class="txt">
        <div class="t1">LevPay Admin</div>
        <div class="t2">API: <span id="apiText" class="mono">—</span></div>
      </div>
    </div>

    <div class="row">
      <button id="btnRefresh" class="btn ghost">Refresh</button>
    </div>
  </header>

  <main class="wrap">
    <aside class="side">
      <button id="navVouchers" class="nav is-active">
        <span>Voucher</span>
        <span class="chip">manage</span>
      </button>
      <button id="navMonthly" class="nav">
        <span>Promo Bulanan</span>
        <span class="chip">code</span>
      </button>
      <button id="navTools" class="nav">
        <span>Tools</span>
        <span class="chip">test</span>
      </button>

      <div class="side__note">
        <div class="noteTitle">Catatan</div>
        <div class="noteText">
          Promo bulanan <b>wajib pakai kode</b>. Unlimited device sudah diset di backend/DB,
          admin cuma punya toggle global <b>Unlimited Mode</b> (ON/OFF).
        </div>
      </div>
    </aside>

    <section class="main">
      <!-- TAB: VOUCHERS -->
      <div id="tabVouchers" class="tab is-on">
        <div class="grid2">
          <div class="card">
            <div class="card__head">
              <div>
                <div class="h1">Voucher List</div>
                <div class="h2">Toggle ON/OFF beneran (langsung update backend).</div>
              </div>
            </div>

            <div class="card__body pad0">
              <div class="tableWrap">
                <table class="table">
                  <thead>
                    <tr>
                      <th>Code</th>
                      <th>Name</th>
                      <th>ON/OFF</th>
                      <th>%</th>
                      <th>Max Rp</th>
                      <th>Uses</th>
                      <th>Expire</th>
                      <th class="right">Aksi</th>
                    </tr>
                  </thead>
                  <tbody id="voucherTbody">
                    <tr><td colspan="8" class="muted">Loading…</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card__head">
              <div>
                <div class="h1">Edit / Upsert Voucher</div>
                <div class="h2">Klik “Edit” dari tabel atau isi manual.</div>
              </div>
            </div>

            <div class="card__body">
              <div class="formGrid">
                <div class="field">
                  <label class="label">Code</label>
                  <input id="v_code" class="input mono" placeholder="VIPL" />
                </div>
                <div class="field">
                  <label class="label">Name</label>
                  <input id="v_name" class="input" placeholder="VIP LEVEL" />
                </div>

                <div class="field">
                  <label class="label">Percent (0-100)</label>
                  <input id="v_percent" class="input mono" inputmode="numeric" placeholder="10" />
                </div>
                <div class="field">
                  <label class="label">Max Rp (0 = ∞)</label>
                  <input id="v_maxRp" class="input mono" inputmode="numeric" value="0" />
                </div>

                <div class="field">
                  <label class="label">Max Uses (kosong = ∞)</label>
                  <input id="v_maxUses" class="input mono" inputmode="numeric" placeholder="5" />
                </div>

                <div class="field">
                  <label class="label">Expires At</label>
                  <input id="v_expiresAt" class="input mono" type="datetime-local" />
                </div>

                <div class="field full">
                  <div class="row between">
                    <div class="label">Enabled</div>
                    <label class="switch">
                      <input id="v_enabled" type="checkbox" checked />
                      <span class="track"></span>
                    </label>
                  </div>
                </div>
              </div>

              <div class="row gap">
                <button id="btnVoucherSave" class="btn primary">Save</button>
                <button id="btnVoucherDisable" class="btn danger">Force OFF</button>
              </div>

              <div class="split">
                <div>
                  <div class="mini">curl</div>
                  <pre id="curlVoucher" class="codebox">—</pre>
                </div>
                <div>
                  <div class="mini">response</div>
                  <pre id="jsonVoucher" class="codebox">—</pre>
                </div>
              </div>

              <div id="voucherMsg" class="msg" style="display:none;"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- TAB: MONTHLY -->
      <div id="tabMonthly" class="tab">
        <div class="card">
          <div class="card__head">
            <div>
              <div class="h1">Promo Bulanan (CODE)</div>
              <div class="h2">User harus input kode yang sama persis.</div>
            </div>
            <div class="row gap">
              <button id="btnMonthlySave" class="btn primary">Save</button>
            </div>
          </div>

          <div class="card__body">
            <div class="grid2">
              <div class="card miniCard">
                <div class="miniHead">
                  <div class="miniTitle">Status Promo</div>
                </div>
                <div class="miniBody">
                  <div class="row between">
                    <div>
                      <div class="k">Promo Enabled</div>
                      <div class="s">ON/OFF promo bulanan.</div>
                    </div>
                    <label class="switch">
                      <input id="m_enabled" type="checkbox" />
                      <span class="track"></span>
                    </label>
                  </div>

                  <div class="hr"></div>

                  <div class="row between">
                    <div>
                      <div class="k">Unlimited Mode</div>
                      <div class="s">ON = device whitelist di backend jadi unlimited. OFF = semua device 1×/bulan.</div>
                    </div>
                    <label class="switch glow">
                      <input id="m_unlimitedEnabled" type="checkbox" />
                      <span class="track"></span>
                    </label>
                  </div>

                  <div class="hr"></div>

                  <div class="row between">
                    <div class="k">Whitelisted devices</div>
                    <div class="mono pill" id="m_unlimitedCount">0</div>
                  </div>

                  <div class="row between">
                    <div class="k">Updated</div>
                    <div class="mono" id="m_updatedAt">—</div>
                  </div>
                </div>
              </div>

              <div class="card miniCard">
                <div class="miniHead">
                  <div class="miniTitle">Config</div>
                </div>
                <div class="miniBody">
                  <div class="formGrid">
                    <div class="field">
                      <label class="label">Kode Bulanan</label>
                      <input id="m_code" class="input mono" placeholder="PROMODEC" />
                      <div class="hint">Wajib diisi. Kalau kosong, monthly gak akan pernah kepake.</div>
                    </div>
                    <div class="field">
                      <label class="label">Nama</label>
                      <input id="m_name" class="input" placeholder="PROMO BULANAN" />
                    </div>

                    <div class="field">
                      <label class="label">Percent</label>
                      <input id="m_percent" class="input mono" inputmode="numeric" placeholder="5" />
                    </div>
                    <div class="field">
                      <label class="label">Max Rp</label>
                      <input id="m_maxRp" class="input mono" inputmode="numeric" placeholder="2000" />
                    </div>

                    <div class="field full">
                      <label class="label">Max Uses / bulan (kosong = ∞)</label>
                      <input id="m_maxUses" class="input mono" inputmode="numeric" placeholder="10" />
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="split">
              <div>
                <div class="mini">curl</div>
                <pre id="curlMonthly" class="codebox">—</pre>
              </div>
              <div>
                <div class="mini">response</div>
                <pre id="jsonMonthly" class="codebox">—</pre>
              </div>
            </div>

            <div id="monthlyMsg" class="msg" style="display:none;"></div>
          </div>
        </div>
      </div>

      <!-- TAB: TOOLS -->
      <div id="tabTools" class="tab">
        <div class="card">
          <div class="card__head">
            <div>
              <div class="h1">Tools: discount.apply</div>
              <div class="h2">Buat ngetes voucher / monthly code langsung.</div>
            </div>
            <div class="row gap">
              <button id="btnRunApply" class="btn primary">Run</button>
            </div>
          </div>

          <div class="card__body">
            <div class="formGrid">
              <div class="field">
                <label class="label">Amount</label>
                <input id="t_amount" class="input mono" inputmode="numeric" value="10000" />
              </div>
              <div class="field">
                <label class="label">Device ID</label>
                <input id="t_deviceId" class="input mono" value="dev_test_1" />
              </div>
              <div class="field">
                <label class="label">Kode (Voucher / Monthly)</label>
                <input id="t_code" class="input mono" placeholder="VIPL / PROMODEC" />
              </div>
              <div class="field">
                <label class="label">reserveTtlMs</label>
                <input id="t_ttl" class="input mono" inputmode="numeric" value="360000" />
              </div>
            </div>

            <div class="split">
              <div>
                <div class="mini">curl</div>
                <pre id="curlApply" class="codebox">—</pre>
              </div>
              <div>
                <div class="mini">response</div>
                <pre id="jsonApply" class="codebox">—</pre>
              </div>
            </div>

            <div class="hint">
              Kalau tools kepotong tapi frontend tidak, biasanya frontend <b>belum pakai finalAmount</b> dari response buat create QR.
            </div>
          </div>
        </div>
      </div>

    </section>
  </main>

  <script src="./admin.js"></script>
</body>
</html>